<div class="home-container">
    <header>
        <h1>Blockchain Voting System</h1>
        <div class="user-info">
            <span>Welcome, {{ (authService.currentUser$ | async)?.email }}</span>
            <button (click)="logout()">Logout</button>
        </div>
    </header>

    @if (isAdmin) {
    <div class="actions">
        <button (click)='createVote()' class="create-btn">Create New Vote</button>
    </div>
    }

    <div class="votes-section">
        <h2>Open Votes</h2>
        @if (openVotes.length === 0) {
        <div>No open votes available.</div>
        }
        @for (vote of openVotes; track vote.voteId) {
        <div class="vote-card" [class.already-voted]="vote.hasVoted">
            <h3>{{ vote.subject }}</h3>
            <p>ID: {{ vote.voteId }}</p>
            @if (vote.hasVoted) {
            <button disabled>Already Voted</button>
            } @else {
            <button [routerLink]="['/vote', vote.voteId]">Vote Now</button>
            }
            @if (isAdmin) {
            <button (click)="endVote(vote.voteId)" class="end-btn">End Vote</button>
            }
        </div>
        }
    </div>

    <div class="votes-section">
        <h2>Closed Votes</h2>
        @if (closedVotes.length === 0) {
        <div>No closed votes available.</div>
        }
        @for (vote of closedVotes; track vote.voteId) {
        <div class="vote-card closed">
            <h3>{{ vote.subject }}</h3>
            <p>Ended: {{ vote.endTime | date:'medium' }}</p>
            <div class="results">
                <h4>Results:</h4>
                <ul>
                    @for (result of vote.results | keyvalue; track result.key) {
                    <li>
                        {{ result.key }}: {{ result.value }} votes
                    </li>
                    }
                </ul>
            </div>
        </div>
        }
    </div>
</div>