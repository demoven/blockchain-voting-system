<div class="create-container">
    <h2>Create New Vote</h2>
    @if (errorMessage) {
    <div class="error">{{ errorMessage }}</div>
    }

    <form [formGroup]="voteForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
            <label for="subject">Subject</label>
            <input type="text" id="subject" formControlName="subject">
        </div>

        <div class="form-group">
            <label>Options</label>
            <div formArrayName="options">
                @for (option of options.controls; track $index) {
                <div class="option-input">
                    <input type="text" [formControlName]="$index" placeholder="Option {{$index + 1}}">
                    @if (options.length > 2) {
                    <button type="button" (click)="removeOption($index)" class="remove-btn">X</button>
                    }
                </div>
                }
            </div>
            <button type="button" (click)="addOption()" class="add-btn">+ Add Option</button>
        </div>

        <div class="form-group">
            <label>Allowed Voters</label>
            <small>Select users who can vote (leave empty for public vote)</small>

            <div class="user-search">
                <input type="text" [(ngModel)]="searchTerm" [ngModelOptions]="{standalone: true}"
                    (input)="filterUsers()" placeholder="Search users by email...">
            </div>

            <div class="user-list">
                @for (user of filteredUsers; track user.uid) {
                <div class="user-item">
                    <input type="checkbox" [id]="user.uid" [checked]="isUserSelected(user.uid)"
                        (change)="toggleUserSelection(user.uid)">
                    <label [for]="user.uid">{{ user.email }}</label>
                </div>
                }
                @if (filteredUsers.length === 0) {
                <div class="no-users">No users found</div>
                }
            </div>
        </div>

        <div class="actions">
            <button type="submit" [disabled]="voteForm.invalid">Create Vote</button>
            <button type="button" (click)="goBack()" class="cancel-btn">Cancel</button>
        </div>
    </form>
</div>